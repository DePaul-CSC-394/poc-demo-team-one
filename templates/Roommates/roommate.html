{% extends 'base.html' %}
{% load static %}

{% block title %}Find Your Next Roommate{% endblock %}
{% block hero %}{% endblock %}
{% block content %}

<div class="container-fluid vh-100">
    <div class="row h-100 align-items-start">
        <!-- Left Form Section -->
        <div class="col-md-6 d-flex flex-column justify-content-start form-section pt-4">
            <h4 class="mb-4 text-center">Answer some lifestyle questions:</h4>

            <form id="questionnaireForm" method="POST" action="{% url 'questionnaire' %}" onsubmit="populateFormInputs()">
            
                {% csrf_token %}

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Do you own pets?</p>
                    <div>
                        <input type="radio" name="owns_pets" value="Yes" onclick="saveAnswer('owns_pets', 'Yes')"> Yes
                        <input type="radio" name="owns_pets" value="No" onclick="saveAnswer('owns_pets', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Are you okay with pets?</p>
                    <div>
                        <input type="radio" name="okay_with_pets" value="Yes" onclick="saveAnswer('okay_with_pets', 'Yes')"> Yes
                        <input type="radio" name="okay_with_pets" value="No" onclick="saveAnswer('okay_with_pets', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Are you looking for a Female Roommate?</p>
                    <div>
                        <input type="radio" name="okay_with_female" value="Yes" onclick="saveAnswer('okay_with_female', 'Yes')"> Yes
                        <input type="radio" name="okay_with_female" value="No" onclick="saveAnswer('okay_with_female', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Are you looking for a Male Roommate?</p>
                    <div>
                        <input type="radio" name="okay_with_male" value="Yes" onclick="saveAnswer('okay_with_male', 'Yes')"> Yes
                        <input type="radio" name="okay_with_male" value="No" onclick="saveAnswer('okay_with_male', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Do you keep a clean living space?</p>
                    <div>
                        <input type="radio" name="cleanliness" value="Yes" onclick="saveAnswer('cleanliness', 'Yes')"> Yes
                        <input type="radio" name="cleanliness" value="No" onclick="saveAnswer('cleanliness', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Do you prefer studying at home?</p>
                    <div>
                        <input type="radio" name="work_study" value="Yes" onclick="saveAnswer('work_study', 'Yes')"> Yes
                        <input type="radio" name="work_study" value="No" onclick="saveAnswer('work_study', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Do you prefer quiet nights?</p>
                    <div>
                        <input type="radio" name="quiet_night" value="Yes" onclick="saveAnswer('quiet_night', 'Yes')"> Yes
                        <input type="radio" name="quiet_night" value="No" onclick="saveAnswer('quiet_night', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Do you host parties at your home?</p>
                    <div>
                        <input type="radio" name="host_gatherings" value="Yes" onclick="saveAnswer('host_gatherings', 'Yes')"> Yes
                        <input type="radio" name="host_gatherings" value="No" onclick="saveAnswer('host_gatherings', 'No')"> No
                    </div>
                </div>

                <div class="question mb-3 d-flex justify-content-between">
                    <p>Are you open to sharing supplies?</p>
                    <div>
                        <input type="radio" name="share_supplies" value="Yes" onclick="saveAnswer('share_supplies', 'Yes')"> Yes
                        <input type="radio" name="share_supplies" value="No" onclick="saveAnswer('share_supplies', 'No')"> No
                    </div>
                </div>

                <!-- Hidden Inputs for Submission -->
                <input type="hidden" name="owns_pets" id="input_owns_pets">
                <input type="hidden" name="okay_with_pets" id="input_okay_with_pets">
                <input type="hidden" name="okay_with_female" id="input_okay_with_female">
                <input type="hidden" name="okay_with_male" id="input_okay_with_male">
                <input type="hidden" name="cleanliness" id="input_cleanliness">
                <input type="hidden" name="work_study" id="input_work_study">
                <input type="hidden" name="quiet_night" id="input_quiet_night">
                <input type="hidden" name="host_gatherings" id="input_host_gatherings">
                <input type="hidden" name="share_supplies" id="input_share_supplies">

                <button type="submit" class="btn btn-dark mt-3">Submit Response</button>
            </form>
        </div>
        <!-- Right Image Section -->
        <div class="col-md-6 image-section d-none d-md-block vh-100"
            style="background: url('https://i.pinimg.com/1200x/83/15/bd/8315bd9b94c114394ae5b9ff6090b3e9.jpg') center/cover; border-radius: 0;">
        </div>
    </div>
</div>

<script>
    function saveAnswer(key, value) {
        let answers = JSON.parse(localStorage.getItem("roommateAnswers")) || {};
        answers[key] = value;
        localStorage.setItem("roommateAnswers", JSON.stringify(answers));

        let inputField = document.getElementById(`input_${key}`);
        if (inputField) {
            inputField.value = value;
        }
    }

    function populateFormInputs() {
        let answers = JSON.parse(localStorage.getItem("roommateAnswers")) || {};
        for (const [key, value] of Object.entries(answers)) {
            let inputField = document.getElementById(`input_${key}`);
            if (inputField) {
                inputField.value = value;
            }
        }
    }

    window.onload = function() {
        let answers = JSON.parse(localStorage.getItem("roommateAnswers")) || {};
        for (const [key, value] of Object.entries(answers)) {
            let radio = document.querySelector(`input[name="${key}"][value="${value}"]`);
            if (radio) {
                radio.checked = true;
            }
        }
        populateFormInputs();
    };

    // Ensure localStorage clears when user sign's out and doesn't reappear when another account logs in
    document.addEventListener("DOMContentLoaded", function() {
        let storedUser = localStorage.getItem("loggedInUser");

        let currentUser = "{{ request.user.username }}";

        if (storedUser !== currentUser) {
            console.log("ðŸ”¹ New user detected. Clearing localStorage...");
            localStorage.clear();
            localStorage.setItem("loggedInUser", currentUser);
        }
    });

</script>

{% endblock %}